# MinIOä½¿ç”¨è¯´æ˜

## 1. ä»€ä¹ˆæ˜¯MinIOï¼Ÿ

MinIOå°±åƒä¸€ä¸ª"äº‘ç«¯æ–‡ä»¶æŸœ"ï¼Œä¸“é—¨ç”¨æ¥å­˜å‚¨å’Œç®¡ç†æ–‡ä»¶ã€‚å¥èº«æˆ¿éœ€è¦å­˜å‚¨ä¼šå‘˜å¤´åƒã€è¯¾ç¨‹å›¾ç‰‡ã€æ•™ç»ƒè¯ä¹¦ç­‰å„ç§æ–‡ä»¶ï¼ŒMinIOå°±æ˜¯å¸®ä½ å®‰å…¨ã€é«˜æ•ˆåœ°ç®¡ç†è¿™äº›æ–‡ä»¶çš„å·¥å…·ã€‚

### ä¸»è¦ä¼˜åŠ¿
- ğŸš€ **é«˜æ€§èƒ½**ï¼šæ–‡ä»¶ä¸Šä¼ ä¸‹è½½é€Ÿåº¦å¿«
- ğŸ”’ **å®‰å…¨å¯é **ï¼šæ”¯æŒæƒé™æ§åˆ¶å’Œæ•°æ®åŠ å¯†
- ğŸ’° **æˆæœ¬ä½**ï¼šå¼€æºå…è´¹ï¼Œéƒ¨ç½²ç®€å•
- ğŸŒ **å…¼å®¹æ€§å¥½**ï¼šå…¼å®¹Amazon S3 API

### å¥èº«æˆ¿ç³»ç»Ÿåº”ç”¨
- ğŸ‘¤ **ä¼šå‘˜å¤´åƒ**ï¼šå­˜å‚¨å’Œå±•ç¤ºä¼šå‘˜ä¸ªäººå¤´åƒ
- ğŸ“¸ **è¯¾ç¨‹å›¾ç‰‡**ï¼šä¸Šä¼ è¯¾ç¨‹å®£ä¼ å›¾å’Œæ•™å­¦å›¾ç‰‡
- ğŸ“„ **æ•™ç»ƒè¯ä¹¦**ï¼šå­˜å‚¨æ•™ç»ƒèµ„æ ¼è¯ä¹¦æ–‡ä»¶
- ğŸ“Š **è¿åŠ¨è§†é¢‘**ï¼šå­˜å‚¨å¥èº«æ•™å­¦è§†é¢‘

## 2. ç¯å¢ƒæ­å»º

### Dockerå¿«é€Ÿå¯åŠ¨
```bash
# å¯åŠ¨MinIOæœåŠ¡
docker run -d \
  --name minio \
  -p 9000:9000 \
  -p 9001:9001 \
  -e "MINIO_ROOT_USER=admin" \
  -e "MINIO_ROOT_PASSWORD=admin123" \
  -v /data:/data \
  minio/minio server /data --console-address ":9001"
```

### è®¿é—®æ§åˆ¶å°
- **APIåœ°å€**ï¼šhttp://localhost:9000
- **ç®¡ç†æ§åˆ¶å°**ï¼šhttp://localhost:9001
- **ç”¨æˆ·å**ï¼šminioadmin
- **å¯†ç **ï¼šminioadmin

## 3. é¡¹ç›®é…ç½®

### æ ¸å¿ƒæ–‡ä»¶ä½ç½®
- **é…ç½®æ–‡ä»¶**ï¼š`application.yml`ä¸­çš„MinIOé…ç½®
- **å±æ€§ç±»**ï¼š`gym-common/src/main/java/com/gym/config/MinioProp.java`
- **é…ç½®ç±»**ï¼š`gym-common/src/main/java/com/gym/config/MinioConfig.java`
- **å·¥å…·ç±»**ï¼š`gym-common/src/main/java/com/gym/utils/MinioUtils.java`
- **æ§åˆ¶å™¨**ï¼š`gym-service-web/src/main/java/com/gym/controller/FileController.java`

### é…ç½®è¯´æ˜
é¡¹ç›®å·²ç»é…ç½®å¥½äº†MinIOçš„è¿æ¥ä¿¡æ¯ï¼ŒåŒ…æ‹¬æœåŠ¡å™¨åœ°å€ã€è®¿é—®å¯†é’¥ã€å­˜å‚¨æ¡¶åç§°ç­‰ã€‚é»˜è®¤ä½¿ç”¨ `gym-files` ä½œä¸ºå­˜å‚¨æ¡¶åç§°ã€‚

## 4. æ–‡ä»¶ä¸Šä¼ æµç¨‹

### åŸºæœ¬ä¸Šä¼ æ­¥éª¤
1. **é€‰æ‹©æ–‡ä»¶**ï¼šå‰ç«¯ç”¨æˆ·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶
2. **å‘é€è¯·æ±‚**ï¼šå°†æ–‡ä»¶å‘é€åˆ°åç«¯ä¸Šä¼ æ¥å£
3. **æ–‡ä»¶éªŒè¯**ï¼šæ£€æŸ¥æ–‡ä»¶ç±»å‹ã€å¤§å°ç­‰
4. **ç”Ÿæˆè·¯å¾„**ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚ç”Ÿæˆå­˜å‚¨è·¯å¾„
5. **ä¸Šä¼ åˆ°MinIO**ï¼šè°ƒç”¨MinIO APIå­˜å‚¨æ–‡ä»¶
6. **è¿”å›URL**ï¼šè¿”å›æ–‡ä»¶çš„è®¿é—®åœ°å€

### æ–‡ä»¶è®¿é—®
ä¸Šä¼ æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡è¿”å›çš„URLç›´æ¥è®¿é—®æ–‡ä»¶ï¼š
```
http://localhost:9000/gym-files/avatar/2024/01/15/user123.jpg
```

## 5. å¸¸ç”¨åŠŸèƒ½ç¤ºä¾‹

### ä¼šå‘˜å¤´åƒä¸Šä¼ 
```javascript
// å‰ç«¯ä¸Šä¼ å¤´åƒ
async function uploadAvatar(file) {
    const formData = new FormData();
    formData.append('file', file);
    formData.append('type', 'avatar');
    
    try {
        const response = await fetch('/api/file/upload', {
            method: 'POST',
            headers: {
                'Authorization': 'Bearer ' + localStorage.getItem('token')
            },
            body: formData
        });
        
        const result = await response.json();
        
        if (result.code === 200) {
            console.log('å¤´åƒä¸Šä¼ æˆåŠŸï¼š', result.data.url);
            // æ›´æ–°é¡µé¢æ˜¾ç¤º
            document.getElementById('avatar').src = result.data.url;
        } else {
            console.error('ä¸Šä¼ å¤±è´¥ï¼š', result.message);
        }
    } catch (error) {
        console.error('ä¸Šä¼ é”™è¯¯ï¼š', error);
    }
}
```

### è¯¾ç¨‹å›¾ç‰‡ä¸Šä¼ 
```javascript
// è¯¾ç¨‹å›¾ç‰‡ä¸Šä¼ 
async function uploadCourseImage(file, courseId) {
    const formData = new FormData();
    formData.append('file', file);
    formData.append('type', 'course');
    formData.append('courseId', courseId);
    
    try {
        const response = await fetch('/api/file/upload', {
            method: 'POST',
            headers: {
                'Authorization': 'Bearer ' + localStorage.getItem('token')
            },
            body: formData
        });
        
        const result = await response.json();
        
        if (result.code === 200) {
            console.log('è¯¾ç¨‹å›¾ç‰‡ä¸Šä¼ æˆåŠŸï¼š', result.data.url);
        }
    } catch (error) {
        console.error('ä¸Šä¼ å¤±è´¥ï¼š', error);
    }
}
```

## 6. é«˜çº§åŠŸèƒ½

### æ‰¹é‡ä¸Šä¼ 
æ”¯æŒä¸€æ¬¡é€‰æ‹©å¤šä¸ªæ–‡ä»¶è¿›è¡Œæ‰¹é‡ä¸Šä¼ ï¼Œæé«˜æ“ä½œæ•ˆç‡ã€‚

### æ–‡ä»¶é¢„è§ˆ
- **å›¾ç‰‡é¢„è§ˆ**ï¼šç›´æ¥åœ¨æµè§ˆå™¨ä¸­æ˜¾ç¤º
- **PDFé¢„è§ˆ**ï¼šæ”¯æŒåœ¨çº¿é¢„è§ˆPDFæ–‡æ¡£
- **è§†é¢‘é¢„è§ˆ**ï¼šæ”¯æŒå¸¸è§è§†é¢‘æ ¼å¼çš„åœ¨çº¿æ’­æ”¾

### æ–‡ä»¶ç®¡ç†
- **æ–‡ä»¶åˆ—è¡¨**ï¼šæŸ¥çœ‹å·²ä¸Šä¼ çš„æ–‡ä»¶
- **æ–‡ä»¶åˆ é™¤**ï¼šåˆ é™¤ä¸éœ€è¦çš„æ–‡ä»¶
- **æ–‡ä»¶é‡å‘½å**ï¼šä¿®æ”¹æ–‡ä»¶åç§°

## 7. å®‰å…¨é…ç½®

### è®¿é—®æƒé™
- **å…¬å¼€è®¿é—®**ï¼šå¤´åƒã€è¯¾ç¨‹å›¾ç‰‡ç­‰å¯ä»¥å…¬å¼€è®¿é—®
- **ç§æœ‰è®¿é—®**ï¼šä¸ªäººè¯ä¹¦ã€ç§å¯†æ–‡ä»¶éœ€è¦æƒé™éªŒè¯
- **ä¸´æ—¶è®¿é—®**ï¼šç”Ÿæˆæœ‰æ—¶æ•ˆæ€§çš„è®¿é—®é“¾æ¥

### æ–‡ä»¶éªŒè¯
- **ç±»å‹æ£€æŸ¥**ï¼šåªå…è®¸æŒ‡å®šç±»å‹çš„æ–‡ä»¶ä¸Šä¼ 
- **å¤§å°é™åˆ¶**ï¼šé™åˆ¶å•ä¸ªæ–‡ä»¶çš„æœ€å¤§å¤§å°
- **å®‰å…¨æ‰«æ**ï¼šæ£€æŸ¥æ–‡ä»¶æ˜¯å¦åŒ…å«æ¶æ„å†…å®¹

## 8. æ€§èƒ½ä¼˜åŒ–

### ä¸Šä¼ ä¼˜åŒ–
- **åˆ†ç‰‡ä¸Šä¼ **ï¼šå¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ ï¼Œæé«˜æˆåŠŸç‡
- **æ–­ç‚¹ç»­ä¼ **ï¼šç½‘ç»œä¸­æ–­åå¯ä»¥ç»§ç»­ä¸Šä¼ 
- **å‹ç¼©å¤„ç†**ï¼šè‡ªåŠ¨å‹ç¼©å›¾ç‰‡ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´

### è®¿é—®ä¼˜åŒ–
- **CDNåŠ é€Ÿ**ï¼šé…ç½®CDNæé«˜æ–‡ä»¶è®¿é—®é€Ÿåº¦
- **ç¼“å­˜ç­–ç•¥**ï¼šè®¾ç½®åˆç†çš„ç¼“å­˜æ—¶é—´
- **è´Ÿè½½å‡è¡¡**ï¼šå¤šä¸ªMinIOèŠ‚ç‚¹åˆ†æ‹…è®¿é—®å‹åŠ›

## 9. å¸¸è§é—®é¢˜

### ä¸Šä¼ å¤±è´¥
**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥æ–‡ä»¶å¤§å°æ˜¯å¦è¶…è¿‡é™åˆ¶
2. ç¡®è®¤æ–‡ä»¶ç±»å‹æ˜¯å¦è¢«å…è®¸
3. æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
4. éªŒè¯MinIOæœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ

### æ–‡ä»¶æ— æ³•è®¿é—®
**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥æ–‡ä»¶URLæ˜¯å¦æ­£ç¡®
2. ç¡®è®¤å­˜å‚¨æ¡¶æƒé™è®¾ç½®
3. æ£€æŸ¥MinIOæœåŠ¡çŠ¶æ€
4. éªŒè¯æ–‡ä»¶æ˜¯å¦çœŸå®å­˜åœ¨

### æ€§èƒ½é—®é¢˜
**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ä¼˜åŒ–æ–‡ä»¶å¤§å°å’Œæ ¼å¼
2. é…ç½®CDNåŠ é€Ÿ
3. å¢åŠ MinIOæœåŠ¡å™¨èµ„æº
4. ä½¿ç”¨æ–‡ä»¶å‹ç¼©

## 10. å¼€å‘è°ƒè¯•

### æœ¬åœ°æµ‹è¯•
1. **å¯åŠ¨MinIO**ï¼šç¡®ä¿Dockerå®¹å™¨æ­£å¸¸è¿è¡Œ
2. **æ£€æŸ¥é…ç½®**ï¼šéªŒè¯application.ymlä¸­çš„é…ç½®
3. **æµ‹è¯•ä¸Šä¼ **ï¼šä½¿ç”¨Postmanæˆ–å‰ç«¯é¡µé¢æµ‹è¯•
4. **æŸ¥çœ‹æ–‡ä»¶**ï¼šåœ¨MinIOæ§åˆ¶å°æŸ¥çœ‹ä¸Šä¼ çš„æ–‡ä»¶

### æ—¥å¿—è°ƒè¯•
- **ä¸Šä¼ æ—¥å¿—**ï¼šæŸ¥çœ‹æ–‡ä»¶ä¸Šä¼ çš„è¯¦ç»†è¿‡ç¨‹
- **é”™è¯¯æ—¥å¿—**ï¼šåˆ†æä¸Šä¼ å¤±è´¥çš„åŸå› 
- **æ€§èƒ½æ—¥å¿—**ï¼šç›‘æ§ä¸Šä¼ ä¸‹è½½çš„æ€§èƒ½

## 11. æœ€ä½³å®è·µ

### æ–‡ä»¶ç»„ç»‡
- **æŒ‰ç±»å‹åˆ†ç±»**ï¼šavatarã€courseã€certificateç­‰
- **æŒ‰æ—¶é—´åˆ†ç»„**ï¼šå¹´/æœˆ/æ—¥çš„ç›®å½•ç»“æ„
- **å‘½åè§„èŒƒ**ï¼šä½¿ç”¨æœ‰æ„ä¹‰çš„æ–‡ä»¶å

### å®‰å…¨å»ºè®®
- **æƒé™æ§åˆ¶**ï¼šä¸¥æ ¼æ§åˆ¶æ–‡ä»¶è®¿é—®æƒé™
- **å®šæœŸå¤‡ä»½**ï¼šé‡è¦æ–‡ä»¶è¦å®šæœŸå¤‡ä»½
- **ç›‘æ§å‘Šè­¦**ï¼šè®¾ç½®å­˜å‚¨ç©ºé—´å’Œè®¿é—®å¼‚å¸¸å‘Šè­¦

## 12. æ€»ç»“

MinIOæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„å¯¹è±¡å­˜å‚¨è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡æœ¬æ–‡æ¡£ï¼Œä½ åº”è¯¥æŒæ¡äº†ï¼š

âœ… **MinIOçš„åŸºæœ¬æ¦‚å¿µ**å’Œåº”ç”¨åœºæ™¯  
âœ… **ç¯å¢ƒæ­å»º**å’Œé¡¹ç›®é…ç½®  
âœ… **æ–‡ä»¶ä¸Šä¼ ä¸‹è½½**çš„å®Œæ•´æµç¨‹  
âœ… **å‰ç«¯é›†æˆ**çš„å®ç°æ–¹æ³•  
âœ… **å®‰å…¨é…ç½®**å’Œæ€§èƒ½ä¼˜åŒ–  
âœ… **é—®é¢˜æ’æŸ¥**å’Œæœ€ä½³å®è·µ  

è®°ä½ï¼šåˆç†ä½¿ç”¨MinIOèƒ½å¤Ÿä¸ºä½ çš„åº”ç”¨æä¾›ç¨³å®šã€é«˜æ•ˆçš„æ–‡ä»¶å­˜å‚¨æœåŠ¡ï¼

---

> ğŸ’¡ **å°è´´å£«**ï¼šå»ºè®®åœ¨å¼€å‘é˜¶æ®µå¤šä½¿ç”¨MinIOæ§åˆ¶å°æŸ¥çœ‹æ–‡ä»¶å­˜å‚¨æƒ…å†µï¼Œæœ‰åŠ©äºç†è§£æ•´ä¸ªæ–‡ä»¶ç®¡ç†æµç¨‹ã€‚

> ğŸ“ **ä»£ç å‚è€ƒ**ï¼šå…·ä½“çš„å®ç°ä»£ç å¯ä»¥æŸ¥çœ‹é¡¹ç›®ä¸­çš„ `MinioUtils.java`ã€`FileController.java` ç­‰æ–‡ä»¶ã€‚